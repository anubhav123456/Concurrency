### Delayed Queue in Java (`DelayQueue`)

In Java, a **Delayed Queue** is implemented using the **`DelayQueue`** class from
`java.util.concurrent`.

It is a **blocking queue** where elements become available **only after a certain delay has expired**.

---

## 1Ô∏è‚É£ What is `DelayQueue`?

* A **thread-safe**, **unbounded**, **blocking queue**
* Elements are ordered based on their **delay time**
* An element can be taken **only when its delay reaches zero or becomes negative**
* Used heavily in **concurrent and scheduling-based systems**

```java
public class DelayQueue<E extends Delayed>
        extends AbstractQueue<E>
        implements BlockingQueue<E>
```

---

## 2Ô∏è‚É£ Key Concept: `Delayed` Interface

Every element stored in a `DelayQueue` **must implement the `Delayed` interface**.

```java
public interface Delayed extends Comparable<Delayed> {
    long getDelay(TimeUnit unit);
}
```

### Two important methods:

1. **`getDelay(TimeUnit unit)`** ‚Üí Remaining delay
2. **`compareTo()`** ‚Üí Ordering inside the queue

---

## 3Ô∏è‚É£ How `DelayQueue` Works Internally

* Internally uses a **PriorityQueue**
* Elements are sorted based on **expiration time**
* The **head** of the queue is the element with the **shortest remaining delay**
* `take()` **blocks** until the delay of the head element expires

---

## 4Ô∏è‚É£ Basic Example

### Custom Delayed Task

```java
import java.util.concurrent.*;

class DelayedTask implements Delayed {
    private final long startTime;
    private final String name;

    public DelayedTask(String name, long delay) {
        this.name = name;
        this.startTime = System.currentTimeMillis() + delay;
    }

    @Override
    public long getDelay(TimeUnit unit) {
        long remaining = startTime - System.currentTimeMillis();
        return unit.convert(remaining, TimeUnit.MILLISECONDS);
    }

    @Override
    public int compareTo(Delayed other) {
        return Long.compare(this.getDelay(TimeUnit.MILLISECONDS),
                            other.getDelay(TimeUnit.MILLISECONDS));
    }

    public String getName() {
        return name;
    }
}
```

### Using `DelayQueue`

```java
public class DelayQueueDemo {
    public static void main(String[] args) throws InterruptedException {
        DelayQueue<DelayedTask> queue = new DelayQueue<>();

        queue.put(new DelayedTask("Task-1", 3000));
        queue.put(new DelayedTask("Task-2", 1000));
        queue.put(new DelayedTask("Task-3", 2000));

        while (!queue.isEmpty()) {
            DelayedTask task = queue.take(); // blocks until delay expires
            System.out.println("Executed: " + task.getName()
                    + " at " + System.currentTimeMillis());
        }
    }
}
```

### Output Order (based on delay)

```
Task-2
Task-3
Task-1
```

---

## 5Ô∏è‚É£ Important Methods

| Method     | Behavior                                      |
| ---------- | --------------------------------------------- |
| `put(E e)` | Inserts element                               |
| `take()`   | Blocks until delay expires                    |
| `poll()`   | Returns element if delay expired, else `null` |
| `peek()`   | Returns head (even if delay not expired)      |
| `size()`   | Total elements (expired + unexpired)          |

---

## 6Ô∏è‚É£ Key Characteristics

‚úÖ Thread-safe
‚úÖ No capacity limit
‚ùå Cannot retrieve elements before delay expires
‚ùå Iteration order is **not guaranteed**

---

## 7Ô∏è‚É£ Real-World Use Cases

* **Task Scheduling**
* **Session expiration**
* **Cache eviction**
* **Retry mechanisms**
* **Rate limiting**
* **Message delay systems**

Example:

> ‚ÄúProcess this task after 5 seconds‚Äù

---

## 8Ô∏è‚É£ `DelayQueue` vs `ScheduledExecutorService`

| DelayQueue            | ScheduledExecutorService        |
| --------------------- | ------------------------------- |
| Low-level control     | High-level abstraction          |
| Manual worker threads | Automatic thread handling       |
| Used in frameworks    | Preferred for simple scheduling |

üëâ Use **`DelayQueue`** when:

* You want **custom scheduling logic**
* You need **fine-grained control**
* Multiple consumers are involved

---

## 9Ô∏è‚É£ Common Interview Points üöÄ

* Why `Delayed` is required
* How blocking works in `take()`
* Difference between `poll()` and `take()`
* Why iteration order is not reliable
* Internal data structure (PriorityQueue)

---
