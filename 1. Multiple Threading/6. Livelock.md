---

# âœ… **Livelock in Java**

---

### What is Livelock?

Livelock is similar to deadlock in the sense that **two or more threads keep interfering with each other**, but unlike deadlock, the threads are **not blocked**.

âž¡ Threads are **active**, keep retrying, rolling back, and responding to each other, but **no real progress is made**.

> In livelock, threads are running, CPU is used, but the program never finishes.

---

## Real-Life Examples of Livelock

### ðŸ¥£ Spoon Example

* Husband and wife share one spoon
* Both are too polite and keep giving the spoon to each other
* Nobody eats â†’ **livelock**

### ðŸš¶ Corridor Example

* Person A moves left, Person B moves right
* Then both switch sides
* Still blocking each other â†’ **livelock**

---

## Bank Deposit Livelock Example

### Scenario

* Two shared accounts: **Student Account** and **University Account**
* **Transaction 1**: Student pays semester fee ($3000)
* **Transaction 2**: University refunds ($1000)
* Both try to complete transactions at the same time

---

## Livelock Execution Flow

1. Transaction 1 withdraws $3000 from Student
2. Transaction 2 withdraws $1000 from University
3. Transaction 1 fails to deposit (University locked) â†’ refunds Student
4. Transaction 2 fails to deposit (Student locked) â†’ refunds University
5. Both retry again
6. âŒ Infinite retries â†’ **Livelock**

---

## Account Class

```java
class Account {
    private final String name;
    private int balance;

    public Account(String name, int balance) {
        this.name = name;
        this.balance = balance;
    }

    public synchronized boolean withdraw(int amount) {
        if (balance >= amount) {
            balance -= amount;
            return true;
        }
        return false;
    }

    public synchronized void deposit(int amount) {
        balance += amount;
    }

    public String getName() {
        return name;
    }
}
```

---

## BankTransferLivelock Class

```java
class BankTransferLivelock {

    public static void payFee(Account student, Account university) {
        while (true) {
            if (student.withdraw(3000)) {
                System.out.println("Student paid 3000, trying to deposit...");

                if (tryDeposit(university, 3000)) {
                    System.out.println("Fee payment successful");
                    break;
                } else {
                    System.out.println("University busy, refunding student");
                    student.deposit(3000);
                }
            }
            sleep();
        }
    }

    public static void refund(Account university, Account student) {
        while (true) {
            if (university.withdraw(1000)) {
                System.out.println("University refunded 1000, trying to deposit...");

                if (tryDeposit(student, 1000)) {
                    System.out.println("Refund successful");
                    break;
                } else {
                    System.out.println("Student busy, refunding university");
                    university.deposit(1000);
                }
            }
            sleep();
        }
    }

    private static boolean tryDeposit(Account account, int amount) {
        synchronized (account) {
            return true; // lock acquired but no coordination
        }
    }

    private static void sleep() {
        try { Thread.sleep(100); } catch (InterruptedException e) {}
    }
}
```

---

## Main Class

```java
public class Main {
    public static void main(String[] args) {
        Account student = new Account("Student Account", 5000);
        Account university = new Account("University Account", 10000);

        Thread t1 = new Thread(() -> BankTransferLivelock.payFee(student, university), "Transaction-1");
        Thread t2 = new Thread(() -> BankTransferLivelock.refund(university, student), "Transaction-2");

        t1.start();
        t2.start();
    }
}
```

---

## Sample Output (Repeats Forever)

```text
Student paid 3000, trying to deposit...
University refunded 1000, trying to deposit...
University busy, refunding student
Student busy, refunding university
Student paid 3000, trying to deposit...
University refunded 1000, trying to deposit...
...
```

âŒ Program never terminates â†’ **Livelock confirmed**

---

## Deadlock vs Livelock

| Deadlock            | Livelock                  |
| ------------------- | ------------------------- |
| Threads are blocked | Threads are active        |
| No CPU usage        | High CPU usage            |
| Waiting for locks   | Repeated retries          |
| Program frozen      | Program running but stuck |

---

## Interview Tip ðŸ§ 

> Deadlock stops execution, livelock keeps execution alive but useless.

---

## How to Fix Livelock (Conceptual)

* Random backoff strategy
* Retry limits
* Fair locking mechanisms
* Better coordination between threads
---